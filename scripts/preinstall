#!/usr/bin/env node

var fs = require('fs')

var exec = require('child_process').exec

var Download = require('download')
var progress = require('download-status')


// Dependencies URLs

const GENFATFS_URL="https://github.com/NodeOS/genfatfs/archive/master.tar.gz"


//
// genfatfs
//

const SRC_DIR='deps/genfatfs'

fs.exists(SRC_DIR, function(exists)
{
  if(exists) return

  process.stdout.write('Downloading genfatfs... ')

  Download({ extract: true, strip: 1 })
  .get(GENFATFS_URL, SRC_DIR)
//  .use(progress())
  .run(function(error)
  {
    if(error) throw error;

    console.log('Done')

    var options = {cwd: SRC_DIR}

    exec('make', options, function(error)
    {
      if(error) throw error;

      console.log("Successfully compiled genfatfs")
    })
  })
})
